cameraViews = {
    HotelFloorplan:
        [
            {
                "position": {
                    "x": 111.68142382801221,
                    "y": 532.3969293197923,
                    "z": 1023.431174023395
                },
                "target": {
                    "x": 111.68142382801221,
                    "y": 532.3969293197923,
                    "z": 34.83437252044678
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 128.41521599829338,
                "height": 90.70650297912894,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            },
            {
                "position": {
                    "x": 173.1911879183776,
                    "y": 231.383955695612,
                    "z": 1023.431174023395
                },
                "target": {
                    "x": 173.1911879183776,
                    "y": 231.383955695612,
                    "z": 34.83437252044678
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 215.2019862421738,
                "height": 152.00861871734594,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            },
            {
                "position": {
                    "x": 693.1768878602618,
                    "y": 224.4211209483585,
                    "z": 1023.431174023395
                },
                "target": {
                    "x": 693.1768878602618,
                    "y": 224.4211209483585,
                    "z": 34.83437252044678
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 184.64860254718118,
                "height": 130.42713736712068,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            },
            {
                "position": {
                    "x": 522.5765952690625,
                    "y": 478.006917373565,
                    "z": 1022.1621568543712
                },
                "target": {
                    "x": 522.5765952690625,
                    "y": 478.006917373565,
                    "z": 26.807723999023438
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 220.43932800000007,
                "height": 155.70803200000006,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            },
            {
                "position": {
                    "x": 227.0673986668312,
                    "y": 436.98898051102003,
                    "z": 1022.1621568543712
                },
                "target": {
                    "x": 227.0673986668312,
                    "y": 436.98898051102003,
                    "z": 26.807723999023438
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 235.13528320000006,
                "height": 166.08856746666675,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            },
            {
                "position": {
                    "x": 530.6343491353796,
                    "y": 77.83448562668524,
                    "z": 1022.1621568543712
                },
                "target": {
                    "x": 530.6343491353796,
                    "y": 77.83448562668524,
                    "z": 26.807723999023438
                },
                "up": {
                    "x": 0,
                    "y": 1,
                    "z": 0
                },
                "width": 201.75186210203793,
                "height": 142.50808004751184,
                "projection": 0,
                "nearLimit": 0.01,
                "className": "Communicator.Camera"
            }
        ],
    Clinic_Architectural_First_Floor_With_Perspective: [
        {
            "position": {
                "x": 116.43349980950687,
                "y": 155.25351917023485,
                "z": 573.7667196286156
            },
            "target": {
                "x": 116.43349980950687,
                "y": 155.25351917023485,
                "z": 218.32234287261963
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 62.27877120000003,
            "height": 44.03459840000003,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 175.5677541890362,
                "y": 50.5162094405424,
                "z": 573.7667196286156
            },
            "target": {
                "x": 175.5677541890362,
                "y": 50.5162094405424,
                "z": 218.32234287261963
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 111.93852672595732,
            "height": 79.14684209224089,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 59.57531230205771,
                "y": 66.01451544484149,
                "z": 573.7667196286156
            },
            "target": {
                "x": 59.57531230205771,
                "y": 66.01451544484149,
                "z": 218.32234287261963
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 67.9036181093202,
            "height": 48.01168192205567,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        }
    ],
    Chieasa_Dives: [
        {
            "position": {
                "x": 100.53144487100109,
                "y": 141.00553172342637,
                "z": 377.89573661322396
            },
            "target": {
                "x": 100.53144487100109,
                "y": 141.00553172342637,
                "z": 57.36418437957764
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 103.80902400000005,
            "height": 73.40032000000002,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 187.30390554732924,
                "y": 77.11326385211346,
                "z": 377.89573661322396
            },
            "target": {
                "x": 187.30390554732924,
                "y": 77.11326385211346,
                "z": 57.36418437957764
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 89.07069840803521,
            "height": 62.979281702651136,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 94.64162554052814,
                "y": 50.610353812825664,
                "z": 377.89573661322396
            },
            "target": {
                "x": 94.64162554052814,
                "y": 50.610353812825664,
                "z": 57.36418437957764
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 78.71517215933962,
            "height": 55.657192435896675,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 119.87340681114559,
                "y": 154.6722687306501,
                "z": 377.30506707530975
            },
            "target": {
                "x": 119.87340681114559,
                "y": 154.6722687306501,
                "z": 56.50900173187256
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 97.32096000000004,
            "height": 68.81280000000002,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 185.06983886231419,
                "y": 154.2284873251384,
                "z": 377.30506707530975
            },
            "target": {
                "x": 185.06983886231419,
                "y": 154.2284873251384,
                "z": 56.50900173187256
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 83.503779757533,
            "height": 59.04307659623545,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        },
        {
            "position": {
                "x": 183.69135514230797,
                "y": 84.68484389345257,
                "z": 377.30506707530975
            },
            "target": {
                "x": 183.69135514230797,
                "y": 84.68484389345257,
                "z": 56.50900173187256
            },
            "up": {
                "x": 0,
                "y": 1,
                "z": 0
            },
            "width": 55.346605424535646,
            "height": 39.13396343148986,
            "projection": 0,
            "nearLimit": 0.01,
            "className": "Communicator.Camera"
        }
    ],
}



function setView(val) {
    var model_name = Sample._getParameterByName("instance");
    var availableSheets = viewer.sheetManager.getSheetIds();

    if (availableSheets[0] == viewer.sheetManager._activeSheetId) {
        var camera = Communicator.Camera.construct(cameraViews[model_name][val]);
    }
    else {
        var camera = Communicator.Camera.construct(cameraViews[model_name][val + 3]);
    }
    viewer.getView().setCamera(camera, 500);
}

function switchSheet(index) {
    var sheet = viewer.sheetManager.getSheetIds();
    viewer.sheetManager.setActiveSheetId(sheet[index]);
}






/*-----------------------------------
------------------------------------
------------------------------------
-----------------------------------*/




document.addEventListener('DOMContentLoaded', function () {
    let viewer = null;
    let currentModel = null;
    let currentModelName = null;
    let isWireframe = false;

    // Initialize dropdown functionality
    document.querySelectorAll('.dropdown-toggle').forEach(button => {
        button.addEventListener('click', function () {
            const dropdown = this.closest('.dropdown');
            const menu = dropdown.querySelector('.dropdown-menu');
            menu.classList.toggle('hidden');
        });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', function (e) {
        if (!e.target.closest('.dropdown')) {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.add('hidden');
            });
        }
    });

    // Initialize the viewer
    function initViewer() {
        if (viewer) {
            viewer.dispose();
        }

        viewer = new Communicator.WebViewer({
            containerId: "viewer-container",
            empty: true,
            endpointUri: ""
        });

        // Set up viewer events
        viewer.setCallbacks({
            sceneReady: function () {
                document.getElementById('loadingIndicator').style.display = 'none';
                setupViewerControls();
                loadCameraPresets();
                checkForSheets();
            },
            sceneReadyFailure: function () {
                document.getElementById('loadingIndicator').style.display = 'none';
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load DWG file'
                });
            }
        });

        return viewer;
    }

    // Load DWG file
    function loadDwgFile(fileUrl, modelName) {
        const loadingIndicator = document.getElementById('loadingIndicator');
        loadingIndicator.style.display = 'flex';

        if (!viewer) {
            viewer = initViewer();
        }

        viewer.loadModel(fileUrl, {
            fileType: Communicator.FileType.Dwg,
            streamingMode: Communicator.StreamingMode.OnDemand
        });

        currentModel = fileUrl;
        currentModelName = modelName;
    }

    // Load camera presets for the current model
    function loadCameraPresets() {
        const presetsContainer = document.getElementById('cameraPresets');
        presetsContainer.innerHTML = '';

        if (!currentModelName || !cameraPresets[currentModelName]) {
            return;
        }

        cameraPresets[currentModelName].forEach((preset, index) => {
            const presetElement = document.createElement('a');
            presetElement.href = 'javascript:void(0);';
            presetElement.className = 'block px-4 py-2 text-gray-800 hover:bg-gray-100';
            presetElement.textContent = preset.name || `View ${index + 1}`;
            presetElement.addEventListener('click', () => {
                setCameraView(preset);
            });
            presetsContainer.appendChild(presetElement);
        });
    }

    // Set camera view based on preset
    function setCameraView(preset) {
        if (!viewer) return;

        const camera = new Communicator.Camera();
        camera.setPosition(new Communicator.Point3(preset.position.x, preset.position.y, preset.position.z));
        camera.setTarget(new Communicator.Point3(preset.target.x, preset.target.y, preset.target.z));
        camera.setUp(new Communicator.Point3(preset.up.x, preset.up.y, preset.up.z));
        camera.setWidth(preset.width);
        camera.setHeight(preset.height);
        camera.setProjection(preset.projection === 0 ?
            Communicator.Projection.Orthographic :
            Communicator.Projection.Perspective);

        viewer.getView().setCamera(camera, 500);
    }

    // Check for available sheets and show controls if needed
    function checkForSheets() {
        if (!viewer || !viewer.sheetManager) {
            document.getElementById('sheetsDropdown').style.display = 'none';
            return;
        }

        const sheetIds = viewer.sheetManager.getSheetIds();
        if (sheetIds.length > 1) {
            const sheetsContainer = document.getElementById('sheetPresets');
            sheetsContainer.innerHTML = '';

            sheetIds.forEach((sheetId, index) => {
                const sheetElement = document.createElement('a');
                sheetElement.href = 'javascript:void(0);';
                sheetElement.className = 'block px-4 py-2 text-gray-800 hover:bg-gray-100';
                sheetElement.textContent = `Sheet ${index + 1}`;
                sheetElement.addEventListener('click', () => {
                    switchSheet(index);
                });
                sheetsContainer.appendChild(sheetElement);
            });

            document.getElementById('sheetsDropdown').style.display = 'block';
        } else {
            document.getElementById('sheetsDropdown').style.display = 'none';
        }
    }

    // Switch between sheets
    function switchSheet(index) {
        if (!viewer || !viewer.sheetManager) return;

        const sheetIds = viewer.sheetManager.getSheetIds();
        if (sheetIds[index]) {
            viewer.sheetManager.setActiveSheetId(sheetIds[index]);
        }
    }

    // Setup viewer controls
    function setupViewerControls() {
        // Zoom controls
        document.getElementById('zoomInBtn').addEventListener('click', function () {
            if (viewer) viewer.view.zoomIn();
        });

        document.getElementById('zoomOutBtn').addEventListener('click', function () {
            if (viewer) viewer.view.zoomOut();
        });

        document.getElementById('fitToViewBtn').addEventListener('click', function () {
            if (viewer) viewer.view.fitWorld();
        });

        document.getElementById('resetViewBtn').addEventListener('click', function () {
            if (viewer && currentModel) {
                loadDwgFile(currentModel, currentModelName);
            }
        });

        // Wireframe toggle
        document.getElementById('toggleWireframeBtn').addEventListener('click', function () {
            if (viewer) {
                isWireframe = !isWireframe;
                viewer.view.setDrawMode(
                    isWireframe ?
                        Communicator.DrawMode.Wireframe :
                        Communicator.DrawMode.Shaded
                );

                const icon = document.querySelector('#toggleWireframeBtn i');
                if (isWireframe) {
                    icon.classList.remove('lucide-grid');
                    icon.classList.add('lucide-box');
                } else {
                    icon.classList.remove('lucide-box');
                    icon.classList.add('lucide-grid');
                }
            }
        });

        // Download button
        document.getElementById('downloadBtn').addEventListener('click', function () {
            if (viewer && currentModel) {
                const link = document.createElement('a');
                link.href = currentModel;
                link.download = currentModel.split('/').pop();
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                Swal.fire({
                    icon: 'warning',
                    title: 'No File Loaded',
                    text: 'Please load a DWG file first'
                });
            }
        });
    }

    // File selection handler
    document.getElementById('loadDwgBtn').addEventListener('click', function () {
        const selectElement = document.getElementById('dwgFileSelect');
        const fileUrl = selectElement.value;
        const modelName = selectElement.options[selectElement.selectedIndex].dataset.modelName;

        if (fileUrl) {
            loadDwgFile(fileUrl, modelName);
        } else {
            Swal.fire({
                icon: 'warning',
                title: 'No File Selected',
                text: 'Please select a DWG file first'
            });
        }
    });

    // Initialize empty viewer
    initViewer();
});
